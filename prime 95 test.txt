# variables.tf
variable "contact_emails" {
  type = list(string)
  default = [
    "your_email@example.com",
    "team@example.com"
  ]
}





terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~>3.0" # Adjust version as needed
    }
  }
}

provider "azurerm" {
  features {} # You'll need your Azure subscription details here
}

resource "azurerm_resource_group" "prime95_rg" {
  name     = "prime95-project-rg"
  location = "westus" # Choose a Free Tier supported location 
}

resource "azurerm_linux_virtual_machine" "prime95_vm" {
  name                  = "prime95-vm"
  resource_group_name   = azurerm_resource_group.prime95_rg.name
  location              = azurerm_resource_group.prime95_rg.location
  size                  = "Standard_B1s" 
  admin_username        = "adminuser" 
  admin_password        = "your-secure-password" 

  os_disk {
    caching              = "ReadWrite"
    storage_account_type = "Standard_LRS"
  }

  source_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "18.04-LTS" 
    version   = "latest"
  }

  # Script to install and run Prime95 
  custom_data = base64encode(<<EOF 
#!/bin/bash
# Update and install dependencies
sudo apt-get update && sudo apt-get install -y any_dependencies_Prime95_needs

# Download Prime95 (assuming a Linux version is available)
wget http://path/to/prime95/linux/binary

# Unpack if needed (replace with appropriate commands)
tar -xvf prime95_binary.tar.gz 

# Execute Prime95 (adjust the path and execution options as needed)
./prime95 
EOF
)

}


resource "azurerm_costmanagement_budget" "example_budget" {
  name                 = "example-resource-group-budget"
  scope                = azurerm_resource_group.example.id
  amount               = 50 # Your desired budget limit 
  time_grain            = "Monthly"
  time_period {
    start_date     = "2024-04-07T00:00:00Z" 
  }

  notification {
    threshold = 90 
    threshold_type = "Actual"
    contact_emails = var.contact_emails
  }
}

